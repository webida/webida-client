<!DOCTYPE html>
<html>
<head>
    <title>IDE</title>

    <link rel="stylesheet" href="../../../bower_components/ladda/dist/ladda.min.css" type="text/css" class="source"/>
    <link rel="stylesheet" href="lib/test/bootstrap/bootstrap.custom.css" type="text/css" class="source"/>
    <link rel="stylesheet" href="lib/tour/tour.css" type="text/css" class="source"/>
    <link rel="stylesheet" href="styles/common/dojo.css" type="text/css" class="source"/>
    <link rel="stylesheet" href="styles/common/dijit.css" type="text/css" class="source"/>
    <link rel="stylesheet" href="styles/common/toastr.min.css" type="text/css" class="source"/>

    <script src="../../../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="./dojoConfig.js" class="source"></script>
    <script src="../../../bower_components/dojo/dojo.js"></script>
    <script src="./lib/modernizr/modernizr-3.2.0-custom.min.js"></script>
    <script>
        require([
            'webida-lib/app',
            'webida-lib/app-config',
            'webida-lib/theme',
            'webida-lib/util/load-polyfills',
            'external/URIjs/src/URI'
        ], function (
            ide,
            config,
            theme,
            loader,
            URI
        ) {
            'use strict';
            theme.loadTheme();
            loader.load(ide.startup);
            if(config.googleAnalytics) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
                ga('create',config.googleAnalytics, 'auto');
                ga('send', 'pageview');
            }

            // dojoConfig.js has handled some tricks for window.nrequire and set __ELECTRON_BROWSER__ already
            // so, within electron, there's always a window.nrequire for node.js
            if (window.__ELECTRON_BROWSER__) {
                var uri = new URI(window.location.href);
                var bootArgs = uri.query(true);
                var desktopConfig = window.localStorage.getItem('webida-desktop-config');
                if (desktopConfig) {
                    console.log('loaded desktop config ' + desktopConfig);
                    desktopConfig = JSON.parse(desktopConfig);
                }
                var browserWindowStatusStorageKey = 'webida-desktop-window-status-' + bootArgs.workspace;
                var browserWindowStatus = window.localStorage.getItem(browserWindowStatusStorageKey);
                var browserWindowStatus = browserWindowStatus ? JSON.parse(browserWindowStatus)
                        : desktopConfig.ideWindowDefaults;
                var browserWindow = window.nrequire('electron').remote.getCurrentWindow();
                if(browserWindowStatus.x) {
                    browserWindow.setBounds(browserWindowStatus);
                } else {
                    browserWindow.setSize(browserWindowStatus.width, browserWindowStatus.height);
                }
                if (browserWindowStatus.maximized) {
                    browserWindow.maximze();
                }
                if (bootArgs.legacy) {
                    window.legacySiteServerConfig = desktopConfig.legacySiteConfigs[bootArgs.legacy];
                    if (!window.legacySiteServerConfig) {
                        alert('cannot read site configuration for legacy remote server');
                    }
                }
                browserWindow.on('close', function(event) {
                    var newStatus = browserWindow.getBounds();
                    newStatus.maximized = browserWindow.isMaximized();
                    newStatus = JSON.stringify(newStatus);
                    console.log('saving browser window status for closing ' + newStatus);
                    window.localStorage.setItem(browserWindowStatusStorageKey, newStatus);
                });
            }
        });
    </script>
</head>
<body class="webida-light" id="ide-body">
</body>
</html>
